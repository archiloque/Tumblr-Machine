<!DOCTYPE html>
<html lang="fr">
<head>
  <title>⌘ Tumblr machine admin</title>
  <meta charset="utf-8">
  <link href="/tumblr-machine.css" rel="stylesheet" type="text/css"/>
  <script src="/jquery.js" type="text/javascript"></script>
  <script src="/jquery.tablesorter.js" type="text/javascript"></script>
  <script src="/tumblr-machine.js" type="text/javascript"></script>
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
</head>
<body>

<h1 id="title">Tumblr Machine</h1>

<div id="messages">
  <% if flash[:error] %>
      <div id="error" class="flash"><%= flash[:error] %></div>
  <% end %>

  <% if flash[:warning] %>
      <div id="warning" class="flash"><%= flash[:warning] %></div>
  <% end %>

  <% if flash[:notice] %>
      <div id="notice" class="flash"><%= flash[:notice] %></div>
  <% end %>
</div>

<div id="left">
  <h2>Add / Edit tag</h2>

  <form action="/edit_tag" method="post">
    <ul class="inputElement">
      <li>
        <label>Name <input type="text" name="tagName"></label>
      </li>
      <li>
        <label>Value <input type="number" name="tagValue"></label>
      </li>
      <li>
        <label>Fetch <input type="checkbox" name="tagFetch" checked="checked"></label>
      </li>
      <li>
        <input name="add_tag" type="submit" value="Submit"/>
      </li>
    </ul>
  </form>

  <h2>Configured tags</h2>
  <table id="tagsTable1" class="tagsTable">
    <thead>
    <tr>
      <th>Name</th>
      <th>Value</th>
      <th>Fetch</th>
      <th>Last Fetch Date</th>
      <th>Posts</th>
    </tr>
    </thead>
    <tbody>
    <% @tags1.each do |tag| %>
        <tr>
          <td><%= TumblrApi.tag_to_link(tag[:n]) %></td>
          <td><%= tag[:v] %></td>
          <td><%= "<a title='Fetch this tag' onclick='fetch(\"#{tag[:n]}\"); return false;'>#{tag[:f] ? 'true' : 'false'}</a>" %></td>
          <td><%= display_date_time(tag[:f] ? tag[:l] : nil) %></td>
          <td><%= tag[:c] %></td>
        </tr>
    <% end %>
    </tbody>
  </table>

  <h2>Next posts</h2>
  <table id="tagsPosts">
    <thead>
    <tr>
      <th>Actions</th>
      <th>Score</th>
      <th>Tumblr</th>
      <th>Tags</th>
    </tr>
    </thead>
    <tbody>
    <% @posts.each do |post| %>
        <tr>
          <td>
            <%= "<a class='b' target='_blank'href='#{post.tumblr.url}/post/#{post.id}' title='View Post'>☞</a>" %>
            <%= "<a class='b' onclick='reblog(#{post.id}); return false;' title='Reblog'>⌘</a>" %>
          </td>
          <td><%= post.score %></td>
          <td><%= "<a title='Go to blog' target='_blank' href='#{post.tumblr.url}'>#{post.tumblr.name}</a>" %></td>
          <td><%= post.tags.collect { |t| TumblrApi.tag_to_link(t.name, ("#{t.name}#{t.value ? "(#{t.value})" : ''}")) }.join(', ') %></td>
        </tr>
    <% end %>
    </tbody>
  </table>

</div>
<div id="right">
  <h2>Other tags</h2>
  <table id="tagsTable2" class="tagsTable">
    <thead>
    <tr>
      <th>Action</th>
      <th>Name</th>
      <th>Posts</th>
    </tr>
    </thead>
    <tbody>
    <% @tags2.each do |tag| %>
        <tr>
          <td><%= "<a title='Fetch this tag' onclick='fetch(\"#{tag[:n]}\"); return false;'>⌘</a>" %></td>
          <td><%= TumblrApi.tag_to_link(tag[:n]) %></td>
          <td><%= tag[:c] %></td>
        </tr>
    <% end %>
    </tbody>
  </table>
</div>
</body>
</html>

