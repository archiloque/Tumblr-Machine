/**
 * jQuery CompactWall v0.0.1
 * A jQuery plugin to organizes blocks in a compact way.
 * http://github.com/archiloque/compact-wall
 *
 * Licensed under the MIT license.
 * Copyright 2012 Julien Kirch
 */(function(a){a.fn.compactWall=function(b,c){function d(a,b){var c=a.slice(0);return c.splice(b,1),c}function e(a,b,c,d,e){var f=a.slice(0);if(a.length>b+1&&a[b+1][1]==c[1]+d[0]&&a[b+1][3]==c[3]-d[1])return f.splice(b,1,[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][2]]),f;var g=c[3]-d[1];return g>=e?(f.splice(b,1,[c[0],c[1]+d[1],d[0],g]),f):(f.splice(b,1),f)}function f(a,b,c,d,e){var f=a.slice(0);if(a.length>b+1&&a[b+1][1]==c[1]+d[1]&&a[b+1][3]==c[3]-d[1])return b==0?(f.splice(0,2,[c[0]+d[0],0,Number.POSITIVE_INFINITY,c[3]],[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][3]]),f):(f.splice(b,1,[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][3]]),f);var g=c[3]-d[1];return g>=e?(f.splice(b,1,[c[0]+d[0],c[1],c[2]-d[0],c[3]],[c[0],c[1]+d[1],d[0],g]),f):(f.splice(b,1,[c[0]+d[0],c[1],c[2]-d[0],c[3]]),f)}function g(a,b,c,d){var e=a.slice(0);return e.splice(b,1,[c[0]+d[0],c[1],c[2]-d[0],c[3]]),e}function i(a,b,c){var d=[0,0,Number.POSITIVE_INFINITY,b],e=new h([],[d],0,b,c);return j(a,e,Number.POSITIVE_INFINITY)}function j(a,b,c){if(a.length==1)return k(a[0],b,c);var d=l(a,b,c);return d&&d.height<c?d:null}function k(a,b,c){var d=null,e=c,f=b.addBlock(a,e);for(var g=0;g<f.length;g++){var h=f[g];h.height<e&&(e=h.height,d=h)}return d}function l(a,b,c){var d=a[0],e=a.slice(1),f=null,g=c,h=b.addBlock(d,g);for(var i=0;i<h.length;i++){var k=h[i],l=j(e,k,g);l&&l.height<g&&(g=l.height,f=l)}return f}var h=function(a,b,c,i,j){this.positionedBlocks=a,this.height=c,this.slots=b,this.addBlock=function(k,l){if(c>=l)return[];var m=[];for(var n=b.length-1;n>=0;n--){var o=b[n];if(o[0]+k[0]<l&&o[2]>=k[0]&&o[3]>=k[1]){var p=[k,o],q=[];o[2]==k[0]?o[3]==k[1]?q=d(b,n):q=e(b,n,o,k,j):k[1]==o[3]?q=g(b,n,o,k):q=f(b,n,o,k,j),m.push(new h(a.concat([p]),q,Math.max(c,o[0]+k[0]),i,j))}}return m}};return this.each(function(d,e){if(b.length==0)return;var f=a.extend({containerWidth:a(e).innerWidth()},c),g=[];for(var h=0;h<b.length;h++){var j=a(b[h]);g.push([j.outerHeight(!0),j.outerWidth(!0),j])}g=g.sort(function(a,b){return b[1]==a[1]?b[0]-a[0]:b[1]-a[1]});var k=g[g.length-1][1],l=i(g,f.containerWidth,k);if(l){for(var m=0;m<l.positionedBlocks.length;m++){var n=l.positionedBlocks[m];a(n[0][2]).css("position","absolute").css("top",n[1][0]).css("left",n[1][1])}a(e).css("position","relative").css("height",l.height)}})}})(jQuery);