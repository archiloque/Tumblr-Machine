/**
 * jQuery CompactWall v0.2.0
 * A jQuery plugin to organizes blocks in a compact way.
 * http://github.com/archiloque/compact-wall
 *
 * Licensed under the MIT license.
 * Copyright 2012 Julien Kirch
 */(function(a){a.fn.compactWall=function(b,c){return this.each(function(d,e){function n(a,b){var c=a.slice(0);return c.splice(b,1),c}function o(a,b,c,d){var e=a.slice(0);if(a.length>b+1&&a[b+1][1]==c[1]+d[1]&&a[b+1][3]==c[3]-d[1])e.splice(b,2,[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][3]]);else{var f=c[3]-d[1];f>=j?e.splice(b,1,[c[0],c[1]+d[1],d[0],f]):e.splice(b,1)}return e}function p(a,b,c,d){var e=a.slice(0);if(a.length>b+1&&a[b+1][1]==c[1]+d[1]&&a[b+1][3]==c[3]-d[1])b==0?e.splice(0,2,[c[0]+d[0],0,Number.POSITIVE_INFINITY,c[3]],[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][3]]):c[0]+d[0]==a[b-1][0]?e.splice(b,2,[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][3]]):e.splice(b,2,[c[0]+d[0],c[1],c[2]-d[0],c[3]],[a[b+1][0],a[b+1][1],a[b+1][2]+d[0],a[b+1][3]]);else{var f=c[3]-d[1];f>=j?e.splice(b,1,[c[0]+d[0],c[1],c[2]-d[0],c[3]],[c[0],c[1]+d[1],d[0],f]):e.splice(b,1,[c[0]+d[0],c[1],c[2]-d[0],c[3]])}return e}function q(a,b,c,d){var e=a.slice(0);return e.splice(b,1,[c[0]+d[0],c[1],c[2]-d[0],c[3]]),e}function r(a,b,c,d,e,f,g){var h=b[0],i=b[1];if(h[3]!=-1)if(h[3]==0)g=[],j=[i[0]*k+i[1]];else if(h[3]>=1){var j=f.slice(0),l=i[0]*k+i[1],m=!1;for(var r=0;!m&&r<f.length;r++)f[r]>l&&(m=!0,j.splice(r,0,l));m||j.push(l);var t=g[j.length];if(t!=null){var u=!0;for(var v=0;u&&v<j.length;v++){var w=t[j[v]];if(!w){u=!1;for(var x=v;x<j.length;x++)t=t[j[x]]={}}else t=w}if(u)return null}else{t=g[j.length]={};for(v=0;v<j.length;v++)t=t[j[v]]={}}}var y=[];i[2]==h[0]?i[3]==h[1]?y=n(a[0],c):y=o(a[0],c,i,h):h[1]==i[3]?y=q(a[0],c,i,h):y=p(a[0],c,i,h);var z=a[1].slice(0);return z.splice(-1,0,b),s([y,z,d],e,g,j)}function s(a,b,c,d){if(m)return null;var e=null,f=b[0],g=b.slice(1),h=a[1];for(var i=a[0].length-1;!m&&i>=0;i--){var j=a[0][i];if(j[0]+f[0]<l&&j[2]>=f[0]&&j[3]>=f[1]){var k=[f,j],n=j[0]+f[0],o=a[2]>n?a[2]:n;if(b.length==1){if(o<=l){l=o;var p=h.slice(0);p.splice(-1,0,k),e=[[],p,o]}}else{var q=r(a,k,i,o,g,d,c);q&&q[2]<=l&&(e=q)}}}return e}function t(a){return f.maxTime!=-1&&window.setTimeout(function(){m=!0},f.maxTime),s([[[0,0,Number.POSITIVE_INFINITY,k]],[],0],a,[],[])}if(b.length==0)return;var f=a.extend({containerWidth:a(e).innerWidth(),maxTime:100},c),g=[];for(var h=0;h<b.length;h++){var i=a(b[h]);g.push([i.outerHeight(!0),i.outerWidth(!0),i,-1])}g=g.sort(function(a,b){return b[1]==a[1]?b[0]-a[0]:b[1]-a[1]});for(h=1;h<g.length;h++)g[h][0]==g[h-1][0]&&g[h][1]==g[h-1][1]&&(g[h-1][3]==-1?(g[h-1][3]=0,g[h][3]=1):g[h][3]=g[h-1][3]+1);var j=g[g.length-1][1],k=f.containerWidth,l=Number.POSITIVE_INFINITY,m=!1,u=t(g);if(u){for(var v=0;v<u[1].length;v++){var w=u[1][v];a(w[0][2]).css("position","absolute").css("top",w[1][0]).css("left",w[1][1])}a(e).css("position","relative").css("height",u[2])}})}})(jQuery);