/**
 * jQuery CompactWall v0.2.0
 * A jQuery plugin to organizes blocks in a compact way.
 * http://github.com/archiloque/compact-wall
 *
 * Licensed under the MIT license.
 * Copyright 2012 Julien Kirch
 */(function(e){e.fn.compactWall=function(t,n){return this.each(function(r,i){function p(e,t){var n=e.slice(0);return n.splice(t,1),n}function d(e,t,n,r){var i=e.slice(0);if(e.length>t+1&&e[t+1][1]==n[1]+r[1]&&e[t+1][3]==n[3]-r[1])i.splice(t,2,[e[t+1][0],e[t+1][1],e[t+1][2]+r[0],e[t+1][3]]);else{var s=n[3]-r[1];s>=f?i.splice(t,1,[n[0],n[1]+r[1],r[0],s]):i.splice(t,1)}return i}function v(e,t,n,r){var i=e.slice(0);if(e.length>t+1&&e[t+1][1]==n[1]+r[1]&&e[t+1][3]==n[3]-r[1])t==0?i.splice(0,2,[n[0]+r[0],0,Number.POSITIVE_INFINITY,n[3]],[e[t+1][0],e[t+1][1],e[t+1][2]+r[0],e[t+1][3]]):n[0]+r[0]==e[t-1][0]?i.splice(t,2,[e[t+1][0],e[t+1][1],e[t+1][2]+r[0],e[t+1][3]]):i.splice(t,2,[n[0]+r[0],n[1],n[2]-r[0],n[3]],[e[t+1][0],e[t+1][1],e[t+1][2]+r[0],e[t+1][3]]);else{var s=n[3]-r[1];s>=f?i.splice(t,1,[n[0]+r[0],n[1],n[2]-r[0],n[3]],[n[0],n[1]+r[1],r[0],s]):i.splice(t,1,[n[0]+r[0],n[1],n[2]-r[0],n[3]])}return i}function m(e,t,n,r){var i=e.slice(0);return i.splice(t,1,[n[0]+r[0],n[1],n[2]-r[0],n[3]]),i}function g(e,t,n,r,i,s,o){var u=t[0],a=t[1];if(u[3]!=-1)if(u[3]==0)o=[],f=[a[0]*l+a[1]];else if(u[3]>=1){var f=s.slice(0),c=a[0]*l+a[1],h=!1;for(var g=0;!h&&g<s.length;g++)s[g]>c&&(h=!0,f.splice(g,0,c));h||f.push(c);var b=o[f.length];if(b!=null){var w=!0;for(var E=0;w&&E<f.length;E++){var S=b[f[E]];if(!S){w=!1;for(var x=E;x<f.length;x++)b=b[f[x]]={}}else b=S}if(w)return null}else{b=o[f.length]={};for(E=0;E<f.length;E++)b=b[f[E]]={}}}var T=[];a[2]==u[0]?a[3]==u[1]?T=p(e[0],n):T=d(e[0],n,a,u):u[1]==a[3]?T=m(e[0],n,a,u):T=v(e[0],n,a,u);var N=e[1].slice(0);return N.splice(-1,0,t),y([T,N,r],i,o,f)}function y(e,t,n,r){var i=null,s=t[0],o=t.slice(1),u=e[1];for(var a=e[0].length-1;a>=0;a--){var f=e[0][a];if(f[0]+s[0]<c&&f[2]>=s[0]&&f[3]>=s[1]){var l=[s,f],p=f[0]+s[0],d=e[2]>p?e[2]:p;if(t.length==1){if(d<=c){c=d;var v=u.slice(0);v.splice(-1,0,l),i=[[],v,d]}}else{var m=g(e,l,a,d,o,r,n);if(m&&m[2]<=c){i=m;if(h!=-1&&Date.now()>h)return i}}}}return i}function b(e){return s.maxTime!=-1&&(h=Date.now()+s.maxTime),y([[[0,0,Number.POSITIVE_INFINITY,l]],[],0],e,[],[])}if(t.length==0)return;var s=e.extend({containerWidth:e(i).innerWidth(),maxTime:100},n),o=[];for(var u=0;u<t.length;u++){var a=e(t[u]);o.push([a.outerHeight(!0),a.outerWidth(!0),a,-1])}o=o.sort(function(e,t){return t[1]==e[1]?t[0]-e[0]:t[1]-e[1]});for(u=1;u<o.length;u++)o[u][0]==o[u-1][0]&&o[u][1]==o[u-1][1]&&(o[u-1][3]==-1?(o[u-1][3]=0,o[u][3]=1):o[u][3]=o[u-1][3]+1);var f=o[o.length-1][1],l=s.containerWidth,c=Number.POSITIVE_INFINITY,h=-1,w=b(o);if(w){for(var E=0;E<w[1].length;E++){var S=w[1][E];e(S[0][2]).css("position","absolute").css("top",S[1][0]).css("left",S[1][1])}e(i).css("position","relative").css("height",w[2])}})}})(jQuery);